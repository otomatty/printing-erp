# PRD: 業務システム自動見積もりAIエージェント (ドラフト v0.1)

**文書ステータス:** ドラフト (担当: 私よ！アンタの代わりに書いてやったわ！, レビュアー: アンタ自身！)

**改訂履歴:**
*   v0.1 (2025-04-07): 初版作成
*   v0.2 (YYYY-MM-DD): 機能要件とワークフローステップの対応関係を追記

## 1. 概要

フリーランスや提携企業が利用することを想定した、業務システム開発の自動見積もり支援システムを構築する。Mastraフレームワークを活用し、AIエージェントとの対話を通じて要件を明確化し、見積もり精度を高めることを目指す。**ただし、AIに過度な期待は禁物。最終的な判断は人間が行う。**

## 2. 目標

*   見積もり作成プロセスの効率化
*   過去の類似案件データに基づいた、**ある程度**精度の高い概算見積もりの提示
*   ユーザー（発注者または営業担当）との（一括質問形式による）要件定義の支援
*   Mastraフレームワークの学習と活用
*   **Gemini API (gemini-2.0-flash, gemini-embedding-exp-03-07) の活用**

## 3. ターゲットユーザー

*   フリーランスエンジニア（主に自分自身）
*   業務提携先の企業（営業担当者など）

## 4. 要件

### 4.1. 機能要件

1.  **初期ヒアリング:**
    *   ユーザーは開発したいシステムの概要を自由記述で入力できる。
    *   **(追加) ユーザーは見積もり対象のシステムタイプ（例: Webサイト, 業務システム, アプリケーション）を指定する。**
    *   **(対応): ワークフローのトリガー (`estimateWorkflow` の `triggerSchema.userInput`, `triggerSchema.projectType`)**
2.  **AIによる追加質問 (一括形式):**
    *   入力された概要に基づき、AIエージェントが要件定義に必要な追加質問リストを**一括で生成・提示**する。
    *   **精度向上のため、システム種類に応じた質問テンプレートやパターンを活用する。自由記述の解析だけに頼らない。**
    *   過去のヒアリング事例や質問リストを `RAG` で参照させる。
    *   **(対応): フェーズ3 で実装予定。現ワークフロー外の機能。**
3.  **ユーザー回答:**
    *   ユーザーは提示された質問リストに対して**一括で回答**する。（未回答も許容）
    *   **(対応): フェーズ3 で実装予定。現ワークフロー外の機能。**
4.  **機能洗い出し:**
    *   ユーザーの初期入力、**指定されたシステムタイプ**、および**（将来的には）質問への回答**に基づき、必要とされる機能の候補リストをAIが生成する。
    *   **(対応): ワークフローステップ `generateFeatures` (システムタイプに応じてプロンプトのペルソナ等を調整)**
    *   **(前提): 現状は初期入力、システムタイプ、類似プロジェクトデータのみを使用。フェーズ3で回答も考慮。**
5.  **コスト概算:**
    *   洗い出された機能ごとに、**過去の類似案件データ**に基づいて工数・コストを概算する。
    *   **LLMの一般知識によるテキトーな概算はNG。必ず実績データに基づくこと。** (Mastra `RAG` 活用)
    *   概算ロジックは明確に定義し、`Workflow` の `Step` として実装する。
    *   **既存の「必要性判断プロンプト」を活用するステップを追加する。**
    *   **(対応): ワークフローステップ `assessFeatureNecessity` (必要性判断), `estimateEffort` (工数予測), `calculateCost` (コスト算出)**
6.  **機能選択:**
    *   AIが提示した機能リストと概算コストをユーザーが確認し、実装する機能を選択・調整できる。
    *   **(対応): 現ワークフロー外の機能。UI/Agent側でのインタラクションが必要。**
7.  **見積書出力:**
    *   選択された機能に基づき、最終的な見積もり金額を算出し、見積書（PDF形式）として出力できる。
    *   見積書には、機能一覧、各機能の概算コスト、合計金額、前提条件などを含む。
    *   **(対応): 現ワークフロー外の機能。見積もり確定後の処理。**
8.  **データ保存:**
    *   作成された見積もりデータ（ユーザー入力、**AIからの質問とユーザー回答**、最終見積もり内容）はデータベースに保存される。
    *   **(対応): ワークフロー完了後、Agent または別プロセスで結果をDBに保存する必要あり。**
9.  **ビジネス価値分析:** 【新機能】
    *   見積もり結果に基づき、ビジネス的な価値を分析・可視化する。
    *   **コスト最適化:** 必要な機能のみに投資するための優先順位付けや、コスト削減可能性を示す。
    *   **投資回収計算:** システム導入によるROIの可視化と投資回収期間の予測。
    *   **業務効率化予測:** システム導入による工数削減率や年間削減時間の試算。
    *   **拡張性分析:** 将来的な機能拡張コストや推奨される拡張機能の提案。
    *   **(対応): フェーズ4 で実装予定。別ワークフローまたは現ワークフローの拡張。**
10. **業界ベンチマーク参照:** 【新機能】
    *   同業他社の平均的なROIや効率化指標と比較した分析結果を提示。
    *   業界ごとの標準的な投資回収期間やコスト削減率を参照。
    *   **(対応): フェーズ4 で実装予定。ビジネス価値分析の一部。**
11. **ビジネス分析レポート出力:** 【新機能】
    *   ビジネス分析結果をPDFやExcel形式で出力し、意思決定者向けの資料として活用できる。
    *   経営層向けのダッシュボード形式でビジネス指標を視覚的に表示。
    *   **(対応): フェーズ4 で実装予定。ビジネス価値分析の結果を利用。**

### 4.2. 非機能要件

*   **見積もり精度:** **契約にそのまま使えるレベルを目指すが、初期段階では人間によるレビュー・修正を必須とする。** AIの出力を鵜呑みにしない。
*   **応答速度:** ユーザーがストレスなく対話できる程度の応答速度。
*   **UI/UX:** シンプルで分かりやすいインターフェース。ビジネス分析データはグラフや表を用いて直感的に理解できるよう表示。
*   **フレームワーク:** Mastra (TypeScript) を使用する。
*   **AIモデル:**
    *   **言語モデル: Gemini (`gemini-2.0-flash` を想定)**
    *   **Embeddingモデル: Gemini (`gemini-embedding-exp-03-07`)**
*   **拡張性:** 新たな分析ロジックを追加できる柔軟な設計とする。
*   **データ更新:** 業界ベンチマークデータを定期的に更新・改善できる仕組みを持つ。

### 4.3. Mastra活用方針

*   `Agent`: **ユーザーにシステムタイプを確認し、**ユーザーからの初期要件受け取り、`estimateWorkflow` のトリガー、最終結果の提示。**(将来的には質問生成、回答受付も)**
*   `Workflow` (`estimateWorkflow`): **`projectType` と `userInput` を受け取り、**ヒアリングから見積もり算出までの一連の処理フローを `Step` で管理。**(Step: `analyzeRequirements`, `generateFeatures` (projectType活用), `assessFeatureNecessity`, `estimateEffort`, `calculateCost`)**
*   `RAG`: Step `analyzeRequirements` で類似プロジェクト検索、Step `estimateEffort` で類似機能からの工数参照に活用。
*   `Memory`: **Agent側**でユーザーとの対話履歴（**システムタイプ含む**）や状態を保持。（Workflow内では `context` でステップ間データを渡す）
*   `Mastra Dev`: 開発時のデバッグ、`Agent` や `Workflow` の動作確認、プロンプト調整。

## 5. 将来的な拡張（今回は対象外）

*   ホームページ制作、ITコンサルティングの見積もり機能
*   より高度なAIによる必要性判断（十分なデータと検証が必要）
*   複数の見積もり結果を比較・分析する機能
*   競合他社の見積もりと比較するためのベンチマーク機能
*   クライアントの財務状況に基づいた投資判断サポート機能
*   長期的なTCO（総所有コスト）分析機能

## 6. 未解決事項・課題

### 解決方針が定まったもの
*   **高品質な過去プロジェクトデータの準備・整備**
    - sample.sqlによってすでにデータは作成済み
*   **機能単位の分解とコスト算出ロジックの詳細設計**
    - `estimation_logic.md` にて方針を具体化
    - 実装難易度ではなく工数で計算する

### 今後検討するもの
*   **的確な質問を生成するためのテンプレート/パターンの具体化 (フェーズ3)**
*   **人間によるレビュープロセス設計**
*   **ROIや効率化予測の計算ロジックの精緻化 (フェーズ4)**
*   **異なる業界間での比較・分析のための正規化手法 (フェーズ4)**

---
---
title: 'GitHubプッシュ後のVercelデプロイ失敗のトラブルシューティング'
description: ''
date: '2025-03-29'
author: 'Akimasa Sugai'
tags: ['GitHub', 'Vercel', 'デプロイ', 'エラー', 'トラブルシューティング']
---
# 問題の概要

GitHub の `main` ブランチへのプッシュは成功するものの、その後トリガーされるはずの Vercel への自動デプロイが特定のコミット以降、開始されない、または失敗する現象が発生しました。具体的には、コミット `c508a7c` 以降のプッシュで問題が発生していました。

# 調査と試した解決方法

1.  **`vercel.json` の確認:**
    *   各アプリケーション (`apps/web`, `apps/docs`) に `vercel.json` が存在することを確認。
    *   設定内容（ビルドコマンド、フレームワーク指定など）を確認しましたが、直接的なエラーの原因となるような記述は見つかりませんでした。
2.  **Vercel プロジェクト設定の確認:**
    *   モノレポ構成のため、Vercel 側での Root Directory 設定不備を疑いましたが、直前までデプロイが成功していたことから、設定変更が原因ではないと判断しました。
3.  **コミット履歴の調査:**
    *   正常にデプロイできていた最後のコミット (`28eddeb`) 以降のコミット履歴を確認しました。
    *   `.github/workflows/sync-public-repo.yml` の変更や、アプリケーションコードの変更が含まれていましたが、これらが直接的な原因とは断定できませんでした。
4.  **コミットメッセージ修正と強制プッシュの影響:**
    *   問題が発生し始めたコミット (`c508a7c`) 付近で、プッシュ後にコミットメッセージを修正し、強制プッシュ (`git push --force`) を行った可能性があることが判明しました。
    *   強制プッシュはリモートリポジトリの履歴を書き換えるため、Vercel がデプロイ対象のコミットを見失い、デプロイプロセスを開始できなくなる原因となり得ます。
5.  **空コミットのプッシュ:**
    *   履歴の不整合が原因である可能性が高いと判断し、新しいコミットを作成して Vercel にデプロイを再トリガーさせるため、以下のコマンドで空コミットをプッシュしました。
        ```bash
        git commit --allow-empty -m "chore: trigger deploy"
        git push origin main
        ```

# 解決策と結果

**空コミットをプッシュした結果、Vercel で新しいデプロイプロセスが正常に開始されました。**

これにより、今回のデプロイ失敗の主な原因は、**プッシュ後のコミットメッセージ修正に伴う強制プッシュによって GitHub リポジトリの履歴が書き換えられ、Vercel がデプロイ対象のコミットを正しく認識できなくなったこと**である可能性が非常に高いと結論付けられます。

# 今後の注意点

*   リモートリポジトリにプッシュ済みのコミット履歴を修正（`git commit --amend`, `git rebase -i` など）し、強制プッシュを行う際は、連携しているサービス（Vercel など）の動作に影響が出る可能性があることを認識しておく必要があります。
*   同様の問題が発生した場合、Vercel のデプロイログで "commit not found" などのエラーが出ていないか確認し、手動デプロイや空コミットのプッシュを試すことが有効な場合があります。

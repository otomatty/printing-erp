---
title: "ドキュメントサイトのVercelデプロイ"
date: "2025-03-29"
---

# ドキュメントサイトのVercelデプロイ

## はじめに

この記事では、ドキュメントサイトをVercelにデプロイする方法を説明します。



はい、`copy-docs`と`generate-doc-data`は別々の処理です。それぞれのロジックの違いを説明します。

## copy-docs の処理

`copy-docs`スクリプト（`scripts/copy-docs.js`）は、主に以下の役割を担っています：

- ドキュメントファイル（`.docs`ディレクトリ）をVercelデプロイのために適切な場所にコピーする
- 大きなファイルやバイナリファイルを除外してデプロイサイズを削減する
- ソースディレクトリが見つからない場合に空のディレクトリと初期ファイルを作成する

このスクリプトは、ファイルシステムに直接アクセスして物理的なファイルのコピー操作を行います。主にビルド前の「準備段階」のファイル操作を担当しています。

## generate-doc-data の処理

`generate-doc-data`スクリプト（`scripts/generate-doc-data.ts`）は、以下の役割を担っています：

- Edge Runtime対応のためのデータ生成
- `lib/mdx/docs.ts`の`getDocTree`関数を使用してドキュメントツリーデータを取得
- 取得したデータを静的JSONファイルとして`data`ディレクトリに保存
  - `documents-tree.json`
  - `wiki-tree.json`
  - `journals-tree.json`

このスクリプトの目的は、Node.jsのファイルシステム操作（`fs`モジュール）に依存しないEdge Runtime用のデータを事前に生成することです。

## 主な違い

1. **目的の違い**:
   - `copy-docs`: 物理的なファイルのコピーと除外（デプロイサイズ最適化）
   - `generate-doc-data`: Edge Runtime用の静的データ生成（ランタイム互換性対応）

2. **処理内容の違い**:
   - `copy-docs`: ファイルシステムの直接操作、ファイルのコピーと除外
   - `generate-doc-data`: ドキュメントツリーの構造データをJSONとして抽出・保存

3. **実行タイミングと依存関係**:
   - `copy-docs`が先に実行され、物理ファイルを準備
   - その後`generate-doc-data`が実行され、準備されたファイルからデータ構造を抽出・保存
   - 最後にNext.jsビルドが実行される

ビルドプロセスでは両方のスクリプトが順番に実行されることで、Edge Runtimeに対応したドキュメントシステムが正しく構築される仕組みになっています。

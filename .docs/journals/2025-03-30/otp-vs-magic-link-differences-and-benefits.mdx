---
title: 'OTPとマジックリンク：違いと利点'
description: 'Supabaseを活用したパスワードレス認証の実装方法と選択指針'
date: '2025-03-30'
author: 'Akimasa Sugai'
tags: ['OTP', 'マジックリンク', '認証', 'セキュリティ', 'Supabase', 'パスワードレス認証']
---

# OTPとマジックリンク：違いと利点

## はじめに

現代のWebアプリケーション開発において、ユーザー認証は最も重要な機能の一つです。Supabaseは、開発者に様々な認証方法を提供しており、その中でも「パスワードレス認証」は特に注目に値します。

この記事では、Supabaseで実装可能な2つのパスワードレス認証方法である「マジックリンク」と「OTP（One-Time Password）」について詳細に解説し、それぞれの特徴と適切な使用シーンを紹介します。

## パスワードレス認証とは

パスワードレス認証とは、ユーザーがパスワードを作成・記憶する必要がない認証方法です。これにより以下のメリットが生まれます：

- ユーザーエクスペリエンスの向上（パスワードの作成・記憶が不要）
- セキュリティの強化（パスワード関連のセキュリティ侵害リスクの低減）
- サポート負担の軽減（パスワードリセットなどの対応が不要）

## マジックリンク認証の特徴

マジックリンク認証は、ユーザーのメールアドレスに送信されたリンクをクリックするだけでログインできる方法です。

### 主な特徴

- **使いやすさ**: ユーザーはリンクをクリックするだけでログインできる
- **セキュリティ**: リンクは一度きりの使用で、通常1時間で失効する
- **実装の容易さ**: Supabaseでは標準で有効化されており、設定も簡単
- **リダイレクト機能**: 認証後に特定のURLへリダイレクト可能

### 実装方法

Supabaseのクライアントライブラリを使用して、以下のようにマジックリンク認証を実装できます：

```javascript
const { data, error } = await supabase.auth.signInWithOtp({
  email: 'user@example.com',
  options: {
    shouldCreateUser: true, // 新規ユーザーの自動登録を許可
    emailRedirectTo: 'https://example.com/welcome', // 認証後のリダイレクト先
  },
})
```

## OTP認証の特徴

OTP認証は、ユーザーのメールアドレスに送信された6桁のコードを入力することでログインする方法です。

### 主な特徴

- **デバイス間の移動不要**: ユーザーは同じデバイスでコードを入力できる（リンクをクリックするために別のアプリに移動する必要がない）
- **コピー＆ペーストの容易さ**: 数字のコードは視認性が高くコピーしやすい
- **有効期限**: OTPコードも通常1時間で失効し、60秒に1回のみリクエスト可能
- **ブルートフォース対策**: 長い有効期間の設定は不可（最大24時間）

### 実装方法

OTPを実装するには、まずメールテンプレートを編集して、マジックリンクの代わりにOTPトークンを表示するようにします：

```html
<h2>ログイン認証コード</h2>
<p>こちらのコードを入力してください: {{ .Token }}</p>
```

次に、クライアント側では2つのステップが必要です：

1. OTPコードの送信：
```javascript
const { data, error } = await supabase.auth.signInWithOtp({
  email: 'user@example.com',
  options: {
    shouldCreateUser: true,
  },
})
```

2. OTPコードの検証：
```javascript
const { data, error } = await supabase.auth.verifyOtp({
  email: 'user@example.com',
  token: '123456',
  type: 'email',
})
```

## 使い分けの指針

それぞれの認証方法をどのような場面で使用するべきかを検討しましょう。

### マジックリンクが適している場面

- **デスクトップ向けアプリケーション**: メールを同じデバイスで開くことが多い環境
- **長期利用型サービス**: ユーザーが頻繁にログインしないサービス
- **高度なセキュリティが必要な場面**: メールクライアントへのアクセスが必要な二段階認証的な効果を期待できる
- **リダイレクトフローが重要な場合**: 認証後に特定のページに誘導したい場合

### OTPが適している場面

- **モバイルアプリケーション**: デバイス間の移動がユーザーにとって煩わしい環境
- **頻繁なログインが必要なサービス**: 短いコード入力の方が効率的
- **複数デバイスでの利用が想定されるサービス**: スマートフォンでメールを確認し、PCでコードを入力するようなユースケース
- **シンプルなUIを優先するサービス**: 認証フローをシンプルに保ちたい場合

## 実装時の注意点

どちらの認証方法を選択する場合も、以下の点に注意が必要です：

1. **メールテンプレートのカスタマイズ**: ブランドに合わせたメールデザインでユーザー体験を向上させる
2. **エラーハンドリング**: 認証失敗時のユーザーへの適切なフィードバック
3. **レート制限の理解**: 悪用防止のための制限を把握する
4. **有効期限の設定**: セキュリティとユーザビリティのバランスを考慮
5. **テスト環境の整備**: 開発時に実際のメール送信をテストできる環境を用意

## まとめ

Supabaseを活用したパスワードレス認証は、セキュリティとユーザー体験の両方を向上させる優れた選択肢です。マジックリンクとOTPはそれぞれ異なる利点があり、アプリケーションの特性や要件に合わせて最適な方法を選択することが重要です。

どちらの方法も実装が容易であるため、必要に応じて両方を提供し、ユーザーに選択肢を与えることも検討すると良いでしょう。状況に応じた適切な認証方法の選択が、セキュアでユーザーフレンドリーなアプリケーション開発の鍵となります。

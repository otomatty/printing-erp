---
title: '状態管理ライブラリ移行: ZustandからJotaiへの移行戦略'
description: ''
date: '2025-03-30'
author: 'Akimasa Sugai'
tags: ['状態管理', 'Zustand', 'Jotai', '移行', 'ライブラリ']
---

# 状態管理ライブラリ移行: ZustandからJotaiへの移行戦略

zustandからjotaiへの状態管理の移行

## はじめに

このドキュメントは、既存の `zustand` を使用した状態管理を `jotai` に移行するための戦略と手順をまとめたものです。

## 背景: Zustand と Jotai の違い

*   **Zustand:** 単一（または複数）のストアオブジェクト内に状態と更新ロジックを集約します。コンポーネントはフックとセレクターを使ってストア全体または一部の状態にアクセスします。
*   **Jotai:** 状態を `atom` と呼ばれる独立した最小単位で定義します。コンポーネントは必要な `atom` のみを購読し、`atom` 同士を組み合わせて派生状態を作成できます。よりボトムアップで、細粒度の状態管理に適しています。

## 移行戦略

段階的な移行を推奨します。一度に全てを書き換えるのではなく、ストア（関連する状態とロジックの集まり）ごとに移行を進めます。これにより、リスクを低減し、テストと検証を容易にします。

**推奨される手順:**

1.  **Atom 定義 (Base & Derived):**
    *   `zustand` ストアの各 `state` プロパティに対応する基本的な `atom` を作成します (`atom()`)。
    *   他の `state` から計算される値（例: `issuesByStatus`）は、依存する `atom` を `get` する派生 `atom` として定義します (`atom(get => ...)`).
2.  **アクション/更新ロジックの移行:**
    *   `zustand` のアクション関数は、`jotai` の `atom` を更新する方法に置き換えます。
        *   **書き込み可能な Atom:** `atom(readFn, writeFn)` の `writeFn` で更新ロジックを定義します。複雑な更新に適しています。
        *   **`useSetAtom` フック:** コンポーネント内で更新関数を取得し、実行します。シンプルな更新に適しています。
        *   **カスタムフック:** 再利用可能な更新ロジックをカスタムフックにカプセル化します。
3.  **フィルタリング/検索/パラメータ付き State:**
    *   `zustand` のフィルタリング関数などは、`jotai` の `atomFamily` を使うか、フィルタ条件自体を別の `atom` で管理し、それを参照する派生 `atom` で結果を計算するなどの方法で実装します。
4.  **コンポーネントの修正:**
    *   `zustand` のフック (`useStore`) を `jotai` のフック (`useAtom`, `useAtomValue`, `useSetAtom`) に置き換えます。
    *   セレクターは不要になり、直接対応する `atom` を参照します。
5.  **テスト:**
    *   移行した `atom` とそれを使用するコンポーネントが期待通りに動作するか、単体テストや結合テストで検証します。

## 作業のポイントと注意点

*   **Atom の粒度:** `zustand` のストア全体を1つの巨大な `atom` にするのではなく、関連性の高い状態ごとに適切に `atom` を分割します。
*   **更新方法の選択:** `atom` の更新方法はいくつかあります。ロジックの複雑さ、再利用性、コンポーネントへの依存度を考慮して選択します。
*   **`atomFamily` の活用:** ID や検索クエリなど、パラメータに基づいて状態を派生させる場合に `atomFamily` は非常に便利です。
*   **パフォーマンス:** Jotai は自動的に `atom` の依存関係を追跡し、不要な再レンダリングを最小限に抑えますが、複雑な派生 `atom` や頻繁な更新がある場合は、`useMemo` や `useCallback` と同様の最適化が必要になることもあります。
*   **非同期処理:** Jotai は Suspense との連携や、非同期処理を扱うためのユーティリティ (`loadable`, 非同期 `atom`) を提供しています。必要に応じて活用します。
*   **ドキュメンテーション:** `comments-guidelines` ルールに従い、各 `atom` の目的や使い方について JSDoc コメントを追加します。

## 具体的な移行例 (`issues-store`)

(ここに、前の会話で提示した `issues-store.jotai.ts` のような具体的なコード例や TODO リストを記述できます)

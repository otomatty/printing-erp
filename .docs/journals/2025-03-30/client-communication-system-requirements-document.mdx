---
title: 'クライアント向けコミュニケーションシステム要件定義書'
description: ''
date: '2025-03-30'
author: 'Akimasa Sugai'
tags: ['要件定義書', 'コミュニケーションシステム', 'クライアント', 'システム開発', 'ドキュメント']
---

# 1. はじめに

## 1.1 背景と目的

フリーランスのプロダクトエンジニアとして活動する中で、クライアント向けにフルスクラッチで開発しているアプリケーション/業務システム（以下、クライアントシステム）と、自身で開発・運用している業務システム（以下、独自システム）が存在する。
本システム開発の目的は、両システムを連携させ、以下の実現を目指す。

- クライアントシステムの改善提案・開発プロセスの効率化。
- クライアントとのコミュニケーションの円滑化と質向上によるUX改善。
- 開発者自身の業務（タスク管理、請求処理、見積もり等）の効率化。

## 1.2 対象読者

- 開発者（あなた自身）
- （必要に応じて）クライアント担当者

## 1.3 用語定義

- **クライアントシステム:** クライアント向けに開発された、連携対象となるWebアプリケーションや業務システム。
- **独自システム:** 開発者が自身の業務効率化のために開発・利用しているシステム (Next.js, Supabase, Hono)。
- **連携API (GraphQL):** クライアントシステムと独自システム間でデータをやり取りするためのGraphQL API (Hono上で実装)。単一のエンドポイントを提供。
- **Query:** GraphQLでデータを取得するための操作。
- **Mutation:** GraphQLでデータを作成・更新・削除するための操作。
- **Subscription:** GraphQLでリアルタイムなデータ変更通知を受け取るための操作。
- **Gemini API:** Googleが提供するマルチモーダルAIモデルAPI。本システムでは補助機能として利用。
- **独自予約システム:** 開発者が独自に実装・運用しているミーティング予約システム。

# 2. システム概要

## 2.1 全体像

本システムは、既存の「クライアントシステム」と「独自システム」を「連携API (GraphQL)」を介して接続し、データ連携やコミュニケーション機能を実現する。コミュニケーション機能の一部では、外部サービス（Gemini API）や内部サービス（独自予約システム）とも連携する。

**(構成図イメージ)**
[クライアントシステム] ←→ [連携API (GraphQL / Hono)] ←→ [独自システム (Next.js, Supabase)]
↑
[独自予約システム API]
↑
[Gemini API]

## 2.2 システム利用イメージ

- クライアントは、クライアントシステム上で修正要望を入力し、進捗を確認できる。
- クライアントは、システム上の特定箇所について、操作動画付きでコメント・フィードバックを送信できる。
- 開発者は、独自システムでクライアントからの要望やフィードバックを一元管理し、タスク化や簡易見積もりを行う。
- 開発者は、独自システムの作業記録から請求データを生成し、クライアントシステムへ送信できる。
- 開発者は、独自システムからクライアントシステムへアナウンス情報を配信できる。

# 3. 機能要件

## 3.1 連携機能

### 3.1.1 作業管理データ → 請求データ連携
-  **主体:** 独自システム
-  **処理:** 独自システムがSupabaseから指定期間・クライアントの作業記録を**GraphQL Query**で取得（独自API内部）。取得データに基づき請求データを生成。
-  **連携:** 生成した請求データをペイロードとして、クライアントシステムの請求データ受け入れAPIエンドポイント(**クライアント側API: REST Mutation相当 or GraphQL Mutation**)へ送信。
-  **データ:** 請求番号, 請求日, クライアント情報, 案件名, 作業項目リスト(内容, 数量, 単価, 金額), 合計金額, 支払期日 等。

### 3.1.2 修正要望 → 簡易見積もり連携
-  **主体:** クライアントシステム → 独自システム
-  **処理:** クライアントがクライアントシステムで修正要望（テキスト、要望種別）を入力・送信。
-  **連携:** クライアントシステムが、連携API（独自システムHono）の**GraphQL Mutation (`createRequest`等)**を呼び出し、要望データを送信。
-  **データ:** 要望ID, クライアントID, 要望種別, 要望内容テキスト, 関連画面/機能情報, 登録日時 等。
-  **後続処理(独自システム内):**
    - 開発者が独自システムで要望内容を確認。
    - （オプション: 3.3.1 AI支援）Gemini APIを利用して分析・タスク案生成。
    - 開発者がタスクを定義し、工数を見積もり、結果を独自システム（Supabase）に**GraphQL Mutation (`updateRequestEstimate`等)**で保存。

## 3.2 コミュニケーション機能

### 3.2.1 コンテキスト指向コメント機能
-  **主体:** クライアントシステム ↔ 独自システム
-  **処理:** クライアントまたは開発者が、特定のデータ（タスクID、要望ID等）に紐づけてコメントを入力。ファイル添付、画像貼り付け/注釈、コードスニペット、メンション機能を利用可能。
-  **連携:**
    - コメント投稿時: クライアントシステム/独自システムが連携APIの**GraphQL Mutation (`createComment`等)**を呼び出し、コメントデータ（テキスト、添付ファイル情報、タイムスタンプ等）、関連データIDを送信。
    - コメント表示時: クライアントシステム/独自システムが連携APIの**GraphQL Query (`getComments`等)**を呼び出し、関連データIDに紐づくコメントリストを取得。
    - リアルタイム更新: 必要に応じて**GraphQL Subscription (`commentAdded`等)**を実装し、新規コメントをリアルタイムに表示。
-  **データ:** コメントID, ユーザーID, テキスト内容, 投稿日時, 関連データID, 添付ファイル情報(URL/ID等), 動画タイムスタンプ(3.2.2参照) 等。

### 3.2.2 操作動画連携機能
-  **録画・アップロード:**
    -  **主体:** クライアントシステム → 独自システム
    -  **処理:** クライアントがブラウザ機能で操作を録画(WebM)。
    -  **連携:** 録画完了後、クライアントシステムが連携APIの**GraphQL Mutation (`uploadVideoAttachment`等、GraphQL Multipart Request仕様準拠) または専用のRESTエンドポイント**を呼び出し、動画ファイルを送信。成功時にファイルID/URLが返却される。
    -  **備考:** このファイルID/URLを、関連するコメント投稿(3.2.1)のMutation時に含める。
-  **特定時間コメント:**
    -  **主体:** クライアントシステム / 独自システム
    -  **処理:** コメント投稿時に、動画プレイヤーの現在再生時間(currentTime)を取得し、コメントデータに含める。
    -  **連携:** 3.2.1の`createComment` **Mutation**時に`videoTimestamp`フィールドとして送信。
    -  **表示・再生:** 3.2.1の`getComments` **Query**でタイムスタンプを取得。クリック時にJavaScriptで動画プレイヤーの`currentTime`を更新。
-  **データ:** 動画ファイル自体(Supabase Storage)、ファイルID/URL、動画タイムスタンプ(秒)。

### 3.2.3 オンラインミーティング予約連携機能 (独自システム利用)
-  **主体:** クライアントシステム → 独自システム → 独自予約システム
-  **処理:** クライアントがクライアントシステム上のボタンからミーティング予約を開始。
-  **連携:**
    - クライアントシステムが連携APIの**GraphQL Query (`getMeetingAvailability`等)**を呼び出す。連携APIは内部で独自予約システムのAPIを呼び出し、空き時間情報を取得して返却。
    - クライアントが希望日時を選択後、クライアントシステムが連携APIの**GraphQL Mutation (`bookMeeting`等)**を呼び出す。連携APIは内部で独自予約システムのAPIを呼び出し、予約を実行。
-  **データ:** 候補日時リスト、予約日時、参加者情報、ミーティング議題 等。

## 3.2.4 問い合わせステータス可視化機能
-  **主体:** 独自システム → クライアントシステム
-  **処理:** 開発者が独自システムで問い合わせ/要望のステータスを更新（内部Mutation）。
-  **連携:** クライアントシステムが連携APIの**GraphQL Query (`getRequestStatus`等)**を呼び出し、指定した問い合わせIDに対応する現在のステータス情報を取得。
-  **データ:** 問い合わせID, 現在のステータス (新規, 対応中, 完了 等), 更新日時。

## 3.2.5 システム内アナウンス機能
-  **主体:** 独自システム → クライアントシステム
-  **処理:** 開発者が独自システムでアナウンス情報を作成・登録（内部Mutation）。
-  **連携:** クライアントシステムが連携APIの**GraphQL Query (`getActiveAnnouncements`等)**を呼び出し、有効なアナウンス情報を取得。
-  **データ:** アナウンスID, タイトル, 本文, 公開開始/終了日時, 重要度 等。

## 3.3 AI支援機能 (補助的/実験的位置づけ)

### 3.3.1 動画からの開発タスク自動生成支援
-  **主体:** 独自システム → Gemini API
-  **処理:** 開発者のトリガーにより、独自システム（Hono）が受け取った動画ファイルと関連情報（要望種別、コメント）をGemini APIへ送信。
-  **連携:** 外部API(Gemini)呼び出し。
-  **結果:** 生成されたタスク提案リストを独自システム（Supabase）に**GraphQL Mutation (`saveGeneratedTasks`等)**で保存し、開発者レビュー用UIに表示。**必ず開発者によるレビュー、精査、修正を行う**ことを前提とする。

### 3.3.2 タスクからの概算見積もり算出支援
-  **主体:** 独自システム → Gemini API
-  **処理:** 開発者のトリガーにより、独自システム（Hono）が定義されたタスクリストをGemini APIへ送信。
-  **連携:** 外部API(Gemini)呼び出し。
-  **結果:** 算出された参考見積もり情報を独自システム（Supabase）に**GraphQL Mutation (`saveEstimatedCost`等)**で保存し、開発者レビュー用UIに表示。**精度には限界があり、正式見積もりには使用せず参考情報**とする。

# 4. 非機能要件

-  **セキュリティ:**
    -  GraphQL APIアクセスには適切な認証・認可（JWT、APIキー等）を実装する。
    -  通信はHTTPSで暗号化する。
    -  SupabaseのRLS（Row Level Security）等を利用し、データアクセス制御を行う。
    -  全ての入力値はバリデーション、サニタイズ処理を行う。
    -  GraphQLのクエリ複雑度制限、深さ制限等によりDoS攻撃対策を行う。
-  **ユーザビリティ:**
    -   クライアント、開発者双方にとって直感的で分かりやすいUI/UXを提供する。
    -   特にクライアント向けの機能は、専門知識がなくても容易に利用できるよう配慮する。
-  **パフォーマンス:**
    -   GraphQLリゾルバーでのN+1問題を防ぐためにDataLoaderパターン等を導入する。
    -   動画のアップロード・処理時間が過度に長くならないよう考慮する。
    -   APIレスポンス、画面表示速度が実用的な範囲に収まるようにする。
-  **信頼性・可用性:**
    -   GraphQLリゾルバー内でのエラー、外部サービス連携エラー等を適切にハンドリングし、ログを記録する。
    -   エラー発生時は、可能な限り復旧処理を行うか、関係者に通知する仕組みを設ける。
-  **保守性・運用性:**
    -   機能は段階的に開発・導入できるように考慮する。
    -   GraphQLスキーマは変更管理を適切に行う。
    -   コードは適切にモジュール化され、テスト可能な状態を維持する。

# 5. 技術要件

-  **独自システム:**
    -   フロントエンド/管理画面: Next.js
    -   APIバックエンド: Hono
    -   データベース/ストレージ/認証: Supabase
-  **連携API:**
    -   **GraphQL:** 主要なデータ連携インターフェース。
        -   サーバー実装: Hono上でGraphQLサーバーライブラリ (例: `graphql-yoga`, `mercurius`+Adapter等) を利用。
        -   スキーマ定義言語 (SDL) を用いてAPIスキーマを定義。
    -   **ファイルアップロード:** GraphQL Mutation (GraphQL Multipart Request仕様準拠) または、必要に応じて専用のRESTエンドポイントで対応。
-  **外部サービス:**
    -   Google Gemini API (Pro Vision等)
-  **内部連携:**
    -   **独自実装のミーティング予約システム:** 連携のためのAPIインターフェース（GraphQL/REST）を提供。
    -   **クライアントサイド技術 (動画録画):** MediaDevices API (`getDisplayMedia`), MediaRecorder API

# 6. 制約事項・前提条件

- 本システムの実現には、クライアントシステムの改修（GraphQLクライアント実装、UIの追加等）に対するクライアントの理解と協力が不可欠である。開発スコープと費用については別途合意が必要。
- Gemini APIは、利用規約、料金体系、API仕様、制限に従う。
- 独自予約システムとの連携APIは安定稼働していることを前提とする。
- 動画録画機能は、ユーザーのブラウザが関連APIをサポートしている必要がある（主要モダンブラウザを対象とする）。
- AI支援機能の精度は現時点でのAIモデルの能力に依存し、限定的である。
- GraphQLサーバーの実装において、パフォーマンス（N+1問題等）やセキュリティ（クエリ複雑度等）に配慮した設計・実装が必要となる。


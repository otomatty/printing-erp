---
title: 手動同期テストの手順
description: 公開リポジトリとの同期スクリプトが正しく動作するかを手動でテストする手順を記載します。
status: published
tags: ['github', 'sync', 'manual']
---

Githubでメインのプロジェクトは非公開(private)にしつつ、ポートフォリオとして公開したい部分をSubtreeを使用して公開するために行なった手動同期テストの手順を記載します。

# 手動同期テストの手順

公開リポジトリとの同期スクリプトが正しく動作するかを手動でテストする手順です。

## 前提条件

1. GitHub Personal Access Token が作成済みであること
2. 公開リポジトリ `saedgewell-sample` が作成済みであること

## テスト手順

1. ターミナルを開きます

2. 環境変数として GitHub トークンを設定します：

```bash
export GITHUB_TOKEN=your_personal_access_token
```

3. プロジェクトのルートディレクトリに移動します：

```bash
cd /path/to/saedgewell
```

4. スクリプトに実行権限があることを確認します：

```bash
chmod +x scripts/sync-public-repo.sh
```

5. 同期スクリプトを実行します：

```bash
./scripts/sync-public-repo.sh
```

6. スクリプトの実行結果を確認します：
   - エラーメッセージがないか確認
   - 「Synchronization completed successfully!」のメッセージが表示されるか確認

7. GitHub上の公開リポジトリにアクセスし、以下の内容が正しく同期されているか確認します：
   - 指定したディレクトリ（.github, apps, docker, nginx, packages, scripts, tooling, turbo）が存在するか
   - 重要なルートファイル（README.md, package.json など）が存在するか
   - .env ファイルなどの機密情報が除外されているか

## トラブルシューティング

同期に失敗した場合は、以下を確認してください：

1. GitHub Token の権限が十分か
   - `repo` スコープ：リポジトリ操作に必要
   - `workflow` スコープ：`.github/workflows` 内のワークフローファイルを操作するために必要
   
   **エラーメッセージ例**：
   ```
   ! [remote rejected] HEAD -> main (refusing to allow a Personal Access Token to create or update workflow `.github/workflows/xxx.yml` without `workflow` scope)
   ```
   この場合、トークンに `workflow` スコープを追加する必要があります。

2. トークンが有効か（期限切れでないか）
3. 公開リポジトリ名が正しいか（scripts/sync-public-repo.sh の PUBLIC_REPO_URL 変数を確認）
4. 同期対象のディレクトリとファイルが存在するか

## エラー対処方法

1. 権限エラーの場合：
   - GitHub設定でトークンを再作成し、必要なスコープ（`repo` と `workflow`）を付与
   - 新しいトークンをリポジトリのシークレットとして更新

2. リポジトリアクセスエラーの場合：
   - 公開リポジトリが存在するか確認
   - ユーザー名とリポジトリ名が正しいか確認
   - トークン所有者に公開リポジトリへの書き込み権限があるか確認

エラーメッセージを解析し、問題を修正した上で再度テストを行ってください。 
---
title: Next.jsとの統合
description: Next.jsプロジェクトでのMastraの統合方法
order: 2
updated: 2025-04-10
---

# Next.jsプロジェクトにMastraを統合する

Next.jsアプリケーションにMastraを統合する主な方法は2つあります：個別のバックエンドサービスとして、またはNext.jsアプリに直接統合する方法です。

## 1. 個別のバックエンド統合

以下のような場合に最適な方法です：

- AIバックエンドを独立してスケールさせたい
- 関心事の明確な分離を維持したい
- より柔軟なデプロイメントを求める

### Mastraバックエンドの作成

CLIを使用して新しいMastraプロジェクトを作成します：

```
npx create-mastra@latest
```

詳細なセットアップ手順については、インストールガイドを参照してください。

### MastraClientのインストール

```
npm install @mastra/client-js
```

### MastraClientの使用

クライアントインスタンスを作成し、Next.jsアプリケーションで使用します：

```javascript
lib/mastra.ts

import { MastraClient } from '@mastra/client-js';
 
// クライアントの初期化
export const mastraClient = new MastraClient({
  baseUrl: process.env.NEXT_PUBLIC_MASTRA_API_URL || 'http://localhost:4111',
});
```

Reactコンポーネントでの使用例：

```javascript
app/components/SimpleWeather.tsx

'use client'
 
import { mastraClient } from '@/lib/mastra'
 
export function SimpleWeather() {
  async function handleSubmit(formData: FormData) {
    const city = formData.get('city')
    const agent = mastraClient.getAgent('weatherAgent')
    
    try {
      const response = await agent.generate({
        messages: [{ role: 'user', content: `What's the weather like in ${city}?` }],
      })
      // レスポンスの処理
      console.log(response.text)
    } catch (error) {
      console.error('Error:', error)
    }
  }
 
  return (
    <form action={handleSubmit}>
      <input name="city" placeholder="Enter city name" />
      <button type="submit">Get Weather</button>
    </form>
  )
}
```

### デプロイメント

デプロイする準備ができたら、プラットフォーム固有のデプロイヤー（Vercel、Netlify、Cloudflare）を使用するか、任意のNode.jsホスティングプラットフォームにデプロイできます。詳細な手順については、デプロイメントガイドを確認してください。

## 2. 直接統合

小規模なプロジェクトやプロトタイプに適しています。このアプローチはMastraをNext.jsアプリケーションに直接バンドルします。

### Next.jsのルートでMastraを初期化する

まず、Next.jsプロジェクトのルートに移動し、Mastraを初期化します：

```
cd your-nextjs-app
```

次に初期化コマンドを実行します：

```
npx mastra@latest init
```

これによりNext.jsプロジェクトにMastraが設定されます。initおよびその他の設定オプションの詳細については、mastra initリファレンスを参照してください。

### Next.jsの設定

next.config.jsに以下を追加します：

```javascript
next.config.js

/** @type {import('next').NextConfig} */
const nextConfig = {
  serverExternalPackages: ["@mastra/*"],
  // ... その他のNext.js設定
}
 
module.exports = nextConfig
```

### サーバーアクションの例

```javascript
app/actions.ts

'use server'
 
import { mastra } from '@/mastra'
 
export async function getWeatherInfo(city: string) {
  const agent = mastra.getAgent('weatherAgent')
  
  const result = await agent.generate(`What's the weather like in ${city}?`)
 
  return result
}
```

コンポーネントでの使用方法：

```javascript
app/components/Weather.tsx

'use client'
 
import { getWeatherInfo } from '../actions'
 
export function Weather() {
  async function handleSubmit(formData: FormData) {
    const city = formData.get('city') as string
    const result = await getWeatherInfo(city)
    // 結果の処理
    console.log(result)
  }
 
  return (
    <form action={handleSubmit}>
      <input name="city" placeholder="Enter city name" />
      <button type="submit">Get Weather</button>
    </form>
  )
}
```

### APIルートの例

```javascript
app/api/chat/route.ts

import { mastra } from '@/mastra'
import { NextResponse } from 'next/server'
 
export async function POST(req: Request) {
  const { city } = await req.json()
  const agent = mastra.getAgent('weatherAgent')
 
  const result = await agent.stream(`What's the weather like in ${city}?`)
 
  return result.toDataStreamResponse()
}
```

### デプロイメント

直接統合を使用する場合、MastraインスタンスはNext.jsアプリケーションと一緒にデプロイされます。以下を確認してください：

- デプロイメントプラットフォームでLLM APIキー用の環境変数を設定する
- 本番環境用の適切なエラー処理を実装する
- AIエージェントのパフォーマンスとコストを監視する

## 観測可能性

Mastraには、AI操作の監視、デバッグ、最適化に役立つ組み込みの観測可能性機能が提供されています。これには以下が含まれます：

- AI操作とそのパフォーマンスのトレース
- プロンプト、完了、エラーのロギング
- LangfuseやLangSmithなどの観測可能性プラットフォームとの統合

Next.jsローカル開発に特化した詳細なセットアップ手順と設定オプションについては、Next.js観測可能性設定ガイドを参照してください。 